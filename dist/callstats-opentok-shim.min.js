/*! callstats-opentok-shim  version = 1.0.3 2020-11-05 04-18-18 */

"use strict";var _slicedToArray=function(){function e(e,n){var r=[],t=!0,o=!1,i=void 0;try{for(var a,c=e[Symbol.iterator]();!(t=(a=c.next()).done)&&(r.push(a.value),!n||r.length!==n);t=!0);}catch(e){o=!0,i=e}finally{try{!t&&c.return&&c.return()}finally{if(o)throw i}}return r}return function(n,r){if(Array.isArray(n))return n;if(Symbol.iterator in Object(n))return e(n,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),CallstatsOpenTok=function(){function e(e){if(!e.iceServers)return!1;for(var n=e.iceServers.length,r=0;r<n;r++){var t=e.iceServers[r].username;if(t&&t.includes("pct"))return!0}return!1}function n(e){return!e}function r(e,n){if(null!==a){var r=a.webRTCFunctions[n];a.reportError(e,l,r)}}function t(e,n,t){return function(o){return r(e,n),t(o)}}function o(){var e=new Map;return i.forEach(function(n,r){e.set(r,n)}),e}var i=new Map,a=null,c=function(){var e=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(n){var r=(e+16*Math.random())%16|0;return("x"==n?r:3&r|8).toString(16)})},l=null,s=null,u=null,d=null,f={audioMute:"audioMute",audioUnmute:"audioUnmute",videoPause:"videoPause",videoResume:"videoResume",screenShareStart:"screenShareStart",screenShareStop:"screenShareStop",dominantSpeaker:"dominantSpeaker"},v=window.RTCPeerConnection||window.webkitRTCPeerConnection||window.mozRTCPeerConnection;if(v){var p=function(o,u){var f=new v(o,u);if(e(o)||n(u))return f;var p=c(),w=p;d&&(w=d);var h=void 0;if(h=void 0===o?"unknown":o.capableSimulcastStreams?"publisher":"subscriber",i.set(p,{peerConnection:f,kind:h}),null!==a){var y=a.fabricUsage.multiplex;a.addNewFabric(f,w,y,l,function(e,n){console.log("Monitoring status: "+e+" msg: "+n)})}else console.warn("Callstats not connected");var g=f.getStats.bind(f);f.getStats=function(){for(var e=arguments.length,n=Array(e),t=0;t<e;t++)n[t]=arguments[t];if(n.length<=1)return s&&s(p,f),g.apply(void 0,n).catch(function(e){throw r(f,"getStats"),e});var o=n[0],i=n[1];return g(function(e){if(s&&s(p,f),o)return o(e)},i)};var x=f.createOffer.bind(f);f.createOffer=function(){for(var e=arguments.length,n=Array(e),o=0;o<e;o++)n[o]=arguments[o];if(n.length<=1)return x.apply(void 0,n).catch(function(e){throw r(f,"createOffer"),e});var i=n[0],a=n[1],c=n[2],l=t(f,"createOffer",c);return x(i,a,c,l)};var C=f.createAnswer.bind(f);f.createAnswer=function(){for(var e=arguments.length,n=Array(e),o=0;o<e;o++)n[o]=arguments[o];if(n.length<=1)return C.apply(void 0,n).catch(function(e){throw r(f,"createAnswer"),e});var i=n[0],a=n[1],c=n[2],l=t(f,"createAnswer",c);return C(i,a,l)};var b=f.setLocalDescription.bind(f);f.setLocalDescription=function(){for(var e=arguments.length,n=Array(e),o=0;o<e;o++)n[o]=arguments[o];if(n.length<=1)return b.apply(void 0,n).catch(function(e){throw r(f,"setLocalDescription"),e});var i=n[0],a=n[1],c=n[2],l=t(f,"setLocalDescription",c);return b(i,a,l)};var S=f.setRemoteDescription.bind(f);f.setRemoteDescription=function(){for(var e=arguments.length,n=Array(e),o=0;o<e;o++)n[o]=arguments[o];if(n.length<=1)return S.apply(void 0,n).catch(function(e){throw r(f,"setRemoteDescription"),e});var i=n[0],a=n[1],c=n[2],l=t(f,"setRemoteDescription",c);return S(i,a,l)};var m=f.addIceCandidate.bind(f);return f.addIceCandidate=function(){for(var e=arguments.length,n=Array(e),o=0;o<e;o++)n[o]=arguments[o];if(n.length<=1)return m.apply(void 0,n).catch(function(e){throw r(f,"addIceCandidate"),e});var i=n[0],a=n[1],c=n[2],l=t(f,"addIceCandidate",c);return m(i,a,l)},f.onsignalingstatechange=function(e){"closed"==e.signalingState&&i.delete(p)},f};["RTCPeerConnection","webkitRTCPeerConnection","mozRTCPeerConnection"].forEach(function(e){window.hasOwnProperty(e)&&(window[e]=p,Object.keys(v).forEach(function(n){window[e][n]=v[n]}),window[e].prototype=v.prototype)})}return{initialize:function(e){u=null,d=null,i=new Map,l=null;var n=null,r=null,t=null;if("function"==typeof e.IdGenerator&&(c=e.IdGenerator),void 0!==e.AppId)if(void 0!==e.AppSecret){if(void 0!==e.SessionId)return l=e.SessionId,"function"==typeof e.OnConnection&&(s=e.OnConnection),void 0!==e.Id?u=e.Id:(console.info("Local identifier not provided. Generating one ..."),u=c()),e.RemoteId&&(d=e.RemoteId),e.InitCallback&&(r=e.InitCallback),e.StatsCallback&&(n=e.StatsCallback),e.ConfigParams&&(t=e.ConfigParams),(a=new callstats).initialize(e.AppId,e.AppSecret,u,r,n,t),a;console.error("callstats SessionId is required")}else console.error("callstats AppSecret is required");else console.error("callstats AppId is required")},getConnections:o,sendUserFeedback:function(e){l?e?a.sendUserFeedback(l,e):console.warn("sendUserFeedback: Invalild Arguments"):console.warn("Not initialized")},sendFabricEvent:function(e){if(l)if(e)if(f.hasOwnProperty(e)){var n=o(),r=!0,t=!1,i=void 0;try{for(var c,s=n[Symbol.iterator]();!(r=(c=s.next()).done);r=!0){var u=c.value,d=_slicedToArray(u,2),v=(d[0],d[1]);v&&"publisher"===v.kind&&(!v.peerConnection||"connected"!==v.peerConnection.iceConnectionState&&"completed"!==v.peerConnection.iceConnectionState||a.sendFabricEvent(v.peerConnection,e,l))}}catch(e){t=!0,i=e}finally{try{!r&&s.return&&s.return()}finally{if(t)throw i}}}else console.warn("sendFabricEvent: Unsupported event");else console.warn("sendFabricEvent: Invalild Arguments");else console.warn("Not initialized")},fabricEvents:f}}();
//# sourceMappingURL=callstats-opentok-shim.min.js.map