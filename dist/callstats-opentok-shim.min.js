/*! callstats-opentok-shim  version = 1.0.2 2019-10-10 11-37-00 */

"use strict";var CallstatsOpenTok=function(){function n(n){if(!n.iceServers)return!1;for(var e=n.iceServers.length,t=0;t<e;t++){var r=n.iceServers[t].username;if(r&&r.includes("pct"))return!0}return!1}function e(n){return!n}function t(n,e){if(null!==o){var t=o.webRTCFunctions[e];o.reportError(n,c,t)}}function r(n,e,r){return function(i){return t(n,e),r(i)}}var i=new Map,o=null,a=function(){var n=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=(n+16*Math.random())%16|0;return("x"==e?t:3&t|8).toString(16)})},c=null,l=null,s=window.RTCPeerConnection||window.webkitRTCPeerConnection||window.mozRTCPeerConnection;if(s){var u=function(u,f){var d=new s(u,f);if(n(u)||e(f))return d;var p=a(),v=void 0;if(v=void 0===u?"unknown":u.capableSimulcastStreams?"publisher":"subscriber",i.set(p,{peerConnection:d,kind:v}),null!==o){var w=o.fabricUsage.multiplex;o.addNewFabric(d,p,w,c,function(n,e){console.log("Monitoring status: "+n+" msg: "+e)})}else console.warn("Callstats not connected");var x=d.getStats.bind(d);d.getStats=function(){for(var n=arguments.length,e=Array(n),r=0;r<n;r++)e[r]=arguments[r];if(e.length<=1)return l&&l(p,d),x.apply(void 0,e).catch(function(n){throw t(d,"getStats"),n});var i=e[0],o=e[1];return x(function(n){if(l&&l(p,d),i)return i(n)},o)};var g=d.createOffer.bind(d);d.createOffer=function(){for(var n=arguments.length,e=Array(n),i=0;i<n;i++)e[i]=arguments[i];if(e.length<=1)return g.apply(void 0,e).catch(function(n){throw t(d,"createOffer"),n});var o=e[0],a=e[1],c=e[2],l=r(d,"createOffer",c);return g(o,a,c,l)};var h=d.createAnswer.bind(d);d.createAnswer=function(){for(var n=arguments.length,e=Array(n),i=0;i<n;i++)e[i]=arguments[i];if(e.length<=1)return h.apply(void 0,e).catch(function(n){throw t(d,"createAnswer"),n});var o=e[0],a=e[1],c=e[2],l=r(d,"createAnswer",c);return h(o,a,l)};var C=d.setLocalDescription.bind(d);d.setLocalDescription=function(){for(var n=arguments.length,e=Array(n),i=0;i<n;i++)e[i]=arguments[i];if(e.length<=1)return C.apply(void 0,e).catch(function(n){throw t(d,"setLocalDescription"),n});var o=e[0],a=e[1],c=e[2],l=r(d,"setLocalDescription",c);return C(o,a,l)};var b=d.setRemoteDescription.bind(d);d.setRemoteDescription=function(){for(var n=arguments.length,e=Array(n),i=0;i<n;i++)e[i]=arguments[i];if(e.length<=1)return b.apply(void 0,e).catch(function(n){throw t(d,"setRemoteDescription"),n});var o=e[0],a=e[1],c=e[2],l=r(d,"setRemoteDescription",c);return b(o,a,l)};var y=d.addIceCandidate.bind(d);return d.addIceCandidate=function(){for(var n=arguments.length,e=Array(n),i=0;i<n;i++)e[i]=arguments[i];if(e.length<=1)return y.apply(void 0,e).catch(function(n){throw t(d,"addIceCandidate"),n});var o=e[0],a=e[1],c=e[2],l=r(d,"addIceCandidate",c);return y(o,a,l)},d.onsignalingstatechange=function(n){"closed"==n.signalingState&&i.delete(p)},d};["RTCPeerConnection","webkitRTCPeerConnection","mozRTCPeerConnection"].forEach(function(n){window.hasOwnProperty(n)&&(window[n]=u,Object.keys(s).forEach(function(e){window[n][e]=s[e]}),window[n].prototype=s.prototype)})}return{initialize:function(n){var e=null,t=null,r=null,i=null;if("function"==typeof n.IdGenerator&&(a=n.IdGenerator),void 0!==n.AppId)if(void 0!==n.AppSecret){if(void 0!==n.SessionId)return c=n.SessionId,"function"==typeof n.OnConnection&&(l=n.OnConnection),void 0!==n.Id?e=n.Id:(console.info("Stats identifier not provided. Generating one ..."),e=a()),n.InitCallback&&(r=n.InitCallback),n.StatsCallback&&(t=n.StatsCallback),n.ConfigParams&&(i=n.ConfigParams),(o=new callstats).initialize(n.AppId,n.AppSecret,e,r,t,i),o;console.error("callstats SessionId is required")}else console.error("callstats AppSecret is required");else console.error("callstats AppId is required")},getConnections:function(){var n=new Map;return i.forEach(function(e,t){n.set(t,e)}),n}}}();
//# sourceMappingURL=callstats-opentok-shim.min.js.map